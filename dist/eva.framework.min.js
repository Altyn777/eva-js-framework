!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){var r,n,o=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function i(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var l,c=[],_=!1,u=-1;function d(){_&&l&&(_=!1,l.length?c=l.concat(c):u=-1,c.length&&h())}function h(){if(!_){var e=i(d);_=!0;for(var t=c.length;t;){for(l=c,c=[];++u<t;)l&&l[u].run();u=-1,t=c.length}l=null,_=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new f(e,t)),1!==c.length||_||i(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=p,o.addListener=p,o.once=p,o.off=p,o.removeListener=p,o.removeAllListeners=p,o.emit=p,o.prependListener=p,o.prependOnceListener=p,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(module,exports,__webpack_require__){"use strict";(function(process,global){function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var eva_framework_version="0.1.12";!function(){if("undefined"!=typeof window)var fetch=window.fetch,WebSocket=window.WebSocket;else if(void 0!==process&&"browser"!==process.title)var fetch=__webpack_require__(3),WebSocket=__webpack_require__(4);var jsaltt=__webpack_require__(5),$cookies=__webpack_require__(7),EVA=function(){function EVA(){_classCallCheck(this,EVA),this.version=eva_framework_version,this.login="",this.password="",this.apikey="",this.api_uri="",this.set_auth_cookies=!0,this.global_cvars=!0,this.api_token="",this.authorized_user=null,this.logged_in=!1,this.debug=!1,this.state_updates=!0,this.ws_mode=void 0!==WebSocket,this.ws=null,this.log={level:20,records:200},this._handlers={"heartbeat.error":this.restart},this._intervals={ajax_reload:2,ajax_log_reload:2,heartbeat:5,reload:5,restart:1},this.log_level_names={10:"DEBUG",20:"INFO",30:"WARNING",40:"ERROR",50:"CRITICAL"},this._heartbeat_reloader=null,this._ajax_reloader=null,this._log_reloader=null,this._scheduled_restarter=null,this._update_state_functions=[],this._update_state_mask_functions=[],this._clear()}return _createClass(EVA,[{key:"_clear",value:function(){this.server_info=null,this.tsdiff=null,this._states=[],this._cvars={},this._log_subscribed=!1,this._log_first_load=!0,this._log_loaded=!1,this._log_started=!1,this._lr2p=[],this._last_ping=null,this._last_pong=null}},{key:"start",value:function(){if(this._cancel_scheduled_restart(),this._debug("framework","version: ".concat(this.version)),void 0===fetch)return jsaltt.logger.error('"fetch" function is unavailable. Upgrade your web browser or connect polyfill (lib/polyfill/fetch.js)'),!1;if(this.logged_in)return this._debug("start","already logged in"),!0;this._last_ping=null,this._last_pong=null;var e={};if(this.apikey)e={k:this.apikey},this._debug("start","logging in with API key");else if(this.password)e={u:this.login,p:this.password},this._debug("start","logging in with password");else if(this.set_auth_cookies){var t=$cookies.read("auth");t?(e={a:t},this._debug("start","logging in with auth token")):this._debug("start","logging in without credentials")}var r,n=this;return this._api_call("login",e).then(function(e){return n.api_token=e.token,r=e.user,n._set_token_cookie(),Promise.all([n._load_states(),n._heartbeat(n,!0),n._start_ws()])}).then(function(){n.ws_mode?(n._ajax_reloader&&clearInterval(n._ajax_reloader),n._intervals.reload&&(n._ajax_reloader=setInterval(function(){n._load_states(n).then(function(){}).catch(function(e){})},1e3*n._intervals.reload))):(n._ajax_reloader&&clearInterval(n._ajax_reloader),n._ajax_reloader=setInterval(function(){n._load_states(n).then(function(){}).catch(function(e){})},1e3*n._intervals.ajax_reload)),n._heartbeat_reloader&&clearInterval(n._heartbeat_reloader),n._heartbeat_reloader=setInterval(function(){n._heartbeat(n).then(function(){}).catch(function(){})},1e3*n._intervals.heartbeat),n._debug("start","login successful, user: ".concat(r)),n.logged_in=!0,n.authorized_user=r,n._invoke_handler("login.success")}).catch(function(e){n.logged_in=!1,void 0===e.code&&(e.code=4,e.message="Unknown error"),n._debug("start","login failed: ".concat(e.code," (").concat(e.message,")")),n._stop_engine(),n.erase_token_cookie(),n._invoke_handler("login.failed",e)}),!0}},{key:"log_start",value:function(e){if(this._log_started=!0,void 0!==e&&(this.log.level=e),(!this.ws_mode||this._log_first_load)&&(this._log_loaded=!1,this._load_log_entries(!0),!this.ws_mode)){var t=this;this._log_reloader=setInterval(function(){t._load_log_entries(!1,t)},1e3*this._intervals.ajax_log_reload)}}},{key:"log_level",value:function(e){this.log.level=e,this._set_ws_log_level(e),this._load_log_entries(!0)}},{key:"restart",value:function(){this._cancel_scheduled_restart(),this._debug("restart","performing restart");var e=this;this.stop(!0).then(function(){e._schedule_restart()}).catch(function(){e._schedule_restart()})}},{key:"erase_token_cookie",value:function(){this.api_token="",this.authorized_user=null,this._set_token_cookie()}},{key:"call",value:function(e,t,r){var n;"string"==typeof t||Array.isArray(t)?(n=jsaltt.extend({},r)).i=t:n=t;var o=this._prepare_call_params(n);return this._api_call(e,o)}},{key:"on",value:function(e,t){this._handlers[e]=t,this._debug("on","setting handler for "+e)}},{key:"interval",value:function(e,t){this._intervals[e]=t}},{key:"cvar",value:function(e){return this._cvars[e]}},{key:"watch",value:function(e,t){if(e.includes("*")){e in this._update_state_mask_functions||(this._update_state_mask_functions[e]=[]),this._update_state_mask_functions[e].push(t);var r=this.state(e);Array.isArray(r)?r.map(t):t(r)}else{e in this._update_state_functions||(this._update_state_functions[e]=[]),this._update_state_functions[e].push(t);var n=this.state(e);void 0!==n&&t(n)}}},{key:"status",value:function(e){var t=this.state(e);if(null!=t)return t.status}},{key:"value",value:function(e){var t=this.state(e);if(null!=t)return Number(t.value)==t.value?Number(t.value):t.value}},{key:"state",value:function(e){if(!e.includes("*"))return e in this._states?this._states[e]:void 0;var t=[];return Object.keys(this._states).map(function(r){this._oid_match(r,e)&&t.push(this._states[r])},this),t}},{key:"expires_in",value:function(e){var t=this.state((e.startsWith("lvar:")?"":"lvar:")+e);if(void 0!==t){if(void 0===t.expires||0==t.expires)return null;if(null!=this.tsdiff){if(0==t.status)return-2;if(-1==t.status)return-1;var r=t.expires-(new Date).getTime()/1e3+this.tsdiff+t.set_time;return r<0&&(r=0),r}}}},{key:"stop",value:function(e){var t=this;return new Promise(function(r,n){t._stop_engine(),t.logged_in=!1,t.call("logout").then(function(){e||t.erase_token_cookie(),r()}).catch(function(r){e||t.erase_token_cookie(),n(r)})})}},{key:"_uuidv4",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)})}},{key:"_api_call",value:function(e,t){var r=this._uuidv4(),n=this.api_uri+"/jrpc",o=this;return this._debug("_api_call","".concat(r,": ").concat(n,": ").concat(e)),new Promise(function(a,s){var i={jsonrpc:"2.0",method:e,params:t,id:r};fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},redirect:"error",body:JSON.stringify(i)}).then(function(e){if(e.ok)o._debug("_api_call",r+" success"),e.json().then(function(e){!1 in e||e.id!=r||!1 in e&&!1 in e?s({code:9,message:"Invalid server response",data:e}):"error"in e?(o._debug("_api_call","".concat(r," failed: ").concat(e.error.code," (").concat(e.error.message,")")),s({code:e.error.code,message:e.error.message,data:e})):a(e.result)}).catch(function(e){var t="Invalid server response";o._debug("_api_call","".concat(r," failed: ").concat(9," (").concat(t,")")),s({code:9,message:t,data:data})});else{o._debug("_api_call","".concat(r," failed: ").concat(7," (").concat("Server error",")")),s({code:7,message:"Server error",data:data})}}).catch(function(e){o._debug("_api_call","".concat(r," failed: ").concat(7," (").concat("Server error",")")),s({code:7,message:"Server error",data:null})})})}},{key:"_heartbeat",value:function _heartbeat(me,on_login){return new Promise(function(resolve,reject){on_login&&(me._last_ping=null);var q={};if(on_login&&(q.icvars=1),me.ws_mode&&(null!==me._last_ping&&(null===me._last_pong||me._last_ping-me._last_pong>me._intervals.heartbeat)&&(me._debug("heartbeat","error: ws ping timeout"),me._invoke_handler("heartbeat.error")),!on_login&&me.ws)){me._last_ping=Date.now()/1e3;try{me._debug("heartbeat","ws ping"),me.ws.send(JSON.stringify({s:"ping"}))}catch(e){return me._debug("heartbeat","error: unable to send ws ping"),me._invoke_handler("heartbeat_error",e),void reject()}}me.call("test",q).then(function(data){me.server_info=data,me.tsdiff=(new Date).getTime()/1e3-data.time,on_login&&(data.cvars?(me._cvars=data.cvars,me.global_cvars&&Object.keys(data.cvars).map(function(k){void 0!==global&&eval("global.".concat(k,'="').concat(data.cvars[k],'"')),"undefined"!=typeof window&&eval("window.".concat(k,'="').concat(data.cvars[k],'"'))})):me._cvars={}),me._invoke_handler("heartbeat.success"),resolve(!0)}).catch(function(e){me._debug("heartbeat","error: unable to send test API call"),me._invoke_handler("heartbeat.error",e)}),me._debug("heartbeat","ok")})}},{key:"_load_log_entries",value:function(e,t){if(!t)t=this;t.ws_mode&&(t._lr2p=[]),t.call("log_get",{l:t.log.level,n:t.log.records}).then(function(r){t.ws_mode&&t._log_first_load&&t._set_ws_log_level(t.log.level),r.map(function(e){return t._invoke_handler("log.record",e)}),t._log_loaded=!0,t._lr2p.map(function(e){return t._invoke_handler("log.record",e)}),e&&t._invoke_handler("log.postprocess"),t._log_first_load=!1}).catch(function(e){jsaltt.logger.error("unable to load log entries")})}},{key:"_schedule_restart",value:function(){var e=this;e._scheduled_restarter=setTimeout(function(){e.start()},1e3*e._intervals.restart)}},{key:"_cancel_scheduled_restart",value:function(){this._scheduled_restarter&&(clearTimeout(this._scheduled_restarter),this._scheduled_restarter=null)}},{key:"_stop_engine",value:function(){if(this._clear(),this._heartbeat_reloader&&(clearInterval(this._heartbeat_reloader),this._heartbeat_reloader=null),this._ajax_reloader&&(clearInterval(this._ajax_reloader),this._ajax_reloader=null),this._log_reloader&&(clearInterval(this._log_reloader),this._log_reloader=null),this.ws)try{this.ws.onclose=null,this.ws.onerror=function(){},this.ws.close()}catch(t){var e=this.ws;setTimeout(function(){try{e.close()}catch(e){}},1e3)}}},{key:"_prepare_call_params",value:function(e){var t=e||{};return this.api_token&&(t.k=this.api_token),t}},{key:"_set_token_cookie",value:function(){var e=this;this.set_auth_cookies&&"undefined"!=typeof document&&["/ui","/pvt","/rpvt"].map(function(t){return document.cookie="auth=".concat(e.api_token,"; path=").concat(t)},this)}},{key:"_load_states",value:function(e){if(!e)e=this;return new Promise(function(t,r){if(e.state_updates){var n={};if(!0!==e.state_updates){var o=e.state_updates.g,a=e.state_updates.p;o&&(n.g=o),a&&(n.p=a)}e.call("state_all",n).then(function(r){r.map(function(t){return e._process_state(t)}),t(!0)}).catch(function(e){r(e)})}else t(!0)})}},{key:"_start_ws",value:function(){var e=this;return new Promise(function(t,r){if(e.ws_mode){var n;if(e.api_uri)n=e.api_uri;else{var o=window.location;n="https:"===o.protocol?"wss:":"ws:",n+="//"+o.host}e.ws=new WebSocket("".concat(n,"/ws?k=").concat(e.api_token)),e.ws.onmessage=function(t){e._process_ws(t)},e.ws.addEventListener("open",function(t){var r;if(e._debug("_start_ws","ws connected"),e.state_updates&&(r={s:"state"},!0!==e.state_updates)){var n=e.state_updates.g;n||(n="#");var o=e.state_updates.p;o||(o="#"),r.g=n,r.tp=o,r.i=[]}r&&e.ws.send(JSON.stringify(r)),e._log_subscribed&&e.log_level(e.log.level)})}t(!0)})}},{key:"_set_ws_log_level",value:function(e){this._log_subscribed=!0;try{this.ws&&this.ws.send(JSON.stringify({s:"log",l:e}))}catch(e){this._debug("log_level","warning: unable to send ws packet")}}},{key:"_process_ws",value:function(e){var t=this,r=JSON.parse(e.data);return"pong"==r.s?(this._debug("ws","pong"),void(this._last_pong=Date.now()/1e3)):"reload"==r.s?(this._debug("ws","reload"),this._invoke_handler("server.reload")):"server"==r.s&&"restart"==r.d?(this._debug("ws","server_restart"),this._invoke_handler("server.restart")):!1!==this._invoke_handler("ws.event",r)?"state"==r.s?(this._debug("ws","state"),void(Array.isArray(r.d)?r.d.map(function(e){return t._process_state(e)},this):this._process_state(r.d))):"log"==r.s?(Array.isArray(r.d)?r.d.map(function(e){return t._preprocess_log_record(e)},this):this._preprocess_log_record(r.d),void this._invoke_handler("log.postprocess")):void 0:void 0}},{key:"_preprocess_log_record",value:function(e){this._log_loaded?this._invoke_handler("log.record",e):this._lr2p.push(e)}},{key:"_process_state",value:function _process_state(state){var z=[],x=[];try{var oid=state.oid;if(oid in this._states){var old_state=this._states[oid];z="",Object.keys(old_state).map(function(e){e in state||(state[e]=old_state[e])})}this._states[oid]=state,jsaltt.cmp(state,old_state)||(this._debug("process_state","".concat(oid," s: ").concat(state.status,' v: "').concat(state.value,'"'),"ns: ".concat(state.nstatus,' nv: "').concat(state.nvalue,'"')),oid in this._update_state_functions&&this._update_state_functions[oid].map(function(f){try{"string"==typeof f||f instanceof String?eval(f):f(state)}catch(e){jsaltt.logger.error("state function processing for ".concat(oid,":"),e)}}),Object.keys(this._update_state_mask_functions).map(function(k){this._oid_match(oid,k)&&this._update_state_mask_functions[k].map(function(f){try{"string"==typeof f||f instanceof String?eval(f):f(state)}catch(e){jsaltt.logger.error("state function processing for ".concat(oid,":"),e)}})},this))}catch(e){jsaltt.logger.error("State processing error, invalid object received",e)}}},{key:"_invoke_handler",value:function _invoke_handler(handler){var f=this._handlers[handler];if(f){this._debug("invoke_handler","invoking for "+handler);try{if("string"==typeof f)return eval(f);if("function"==typeof f)return f.apply(this,[].slice.call(arguments,1))}catch(e){jsaltt.logger.error("handler for ".concat(handler,":"),e)}}}},{key:"_oid_match",value:function(e,t){return new RegExp("^"+t.split("*").join(".*")+"$").test(e)}},{key:"_debug",value:function(e){this.debug&&jsaltt.logger.debug.apply(jsaltt.logger,["EVA::"+e].concat([].slice.call(arguments,1)))}}]),EVA}();"object"===_typeof(exports)&&(exports.EVA=EVA),"object"===("undefined"==typeof window?"undefined":_typeof(window))&&(window.$eva=new EVA,window.eva_framework_version=eva_framework_version)}()}).call(this,__webpack_require__(0),__webpack_require__(2))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports=node-fetch},function(e,t){e.exports=ws},function(e,t,r){"use strict";(function(e){(()=>{if(void 0!==e&&"browser"!==e.title)var n=r(6);function o(){var e=function(){var t={},r=!1,n=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(r=arguments[0],n++);for(var a=function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r&&"[object Object]"===Object.prototype.toString.call(n[o])?t[o]=e(!0,t[o],n[o]):t[o]=n[o])};n<o;n++){a(arguments[n])}return t};return e.apply(null,arguments)}function a(e,t){if(void 0===e||void 0===t)return!1;var r=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t);if(r.length!=n.length)return!1;for(var o=0;o<r.length;o++){var a=r[o];if(!Array.isArray(e[a])&&e[a]!==t[a])return!1}return!0}class s{constructor(){this.log=console.log,this.colored=void 0!==n||"undefined"!=typeof window}_msg(e,t){if(arguments.length>2){var r=[].slice.call(arguments,2);if(this.colored){var n=[];if(t)r.map(function(e){e&&e.stack&&e.message||"object"==typeof e?n.push(e):n.push(t(e))});else{for(var o,a=!!e,s=0;s<r.length;s++){var i=r[s];!a||i&&i.stack&&i.message||"object"==typeof i?(a&&(a=!1,n.push(o),n.push(e)),n.push(i),o=null):(o?o+=" ":o="%c",o+=i)}o&&(n.push(o),n.push(e))}r=n}console.log.apply(null,r)}}debug(){var e,t;void 0===n?e="font-size: 12px; color: #999":t=n.gray,this._msg.apply(this,[e,t].concat(Array.from(arguments)))}info(){var e,t;void 0!==n||(e="font-size: 12px; color: black"),this._msg.apply(this,[e,t].concat(Array.from(arguments)))}warning(){var e,t;void 0===n?e="font-size: 14px; color: orange; font-weight: bold":t=n.bold.yellow,this._msg.apply(this,[e,t].concat(Array.from(arguments)))}error(){var e,t;void 0===n?e="font-size: 16px; color: red; font-weight: bold":t=n.bold.red,this._msg.apply(this,[e,t].concat(Array.from(arguments)))}critical(){var e,t;void 0===n?e="font-size: 25px; color: red; font-weight: bold":t=n.bold.red,this._msg.apply(this,[e,t].concat(Array.from(arguments)))}}t.logger=new s,t.Logging=s,t.extend=o,t.cmp=a,"object"==typeof window&&(window.jsaltt={logger:new s,extend:o,cmp:a},window.$log=window.jsaltt.logger)})()}).call(this,r(0))},function(e,t){e.exports=chalk},function(e,t,r){"use strict";(()=>{function e(e,t,r,n){if("undefined"!=typeof document){var o,a=void 0!==n?n:"";if(r){var s=new Date;s.setTime(s.getTime()+24*r*60*60*1e3),o=s.toUTCString()}else o="";return document.cookie=`${e}=${t}; expires=${o}; path=${a}`,!0}}function r(e){if("undefined"!=typeof document){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null}}function n(t,r){return e(t,"",-1,r)}t.read=r,t.create=e,t.erase=n,"object"==typeof window&&(window.$cookies={read:r,create:e,erase:n})})()}]);